<%-include("../layout/adminheader.ejs")%>
<!-- <script src="https://cdn.jsdelivr.net/npm/apexcharts@3.28.3/dist/apexcharts.min.js"></script> -->
        <!-- ============================================================== -->
        <!-- Start right Content here -->
        <!-- ============================================================== -->
        
        <div class="main-content">

            <div class="page-content">
                <div class="container-fluid">

                    <div class="row">
                        <div class="col">

                            <div class="h-100">
                                <div class="row mb-3 pb-1">
                                    <div class="col-12">
                                        <div class="d-flex align-items-lg-center flex-lg-row flex-column">
                                            <div class="flex-grow-1">
                                                <h4 class="fs-16 mb-1">Good Morning, Admin!</h4>
                                                <p class="text-muted mb-0">Here's what's happening with your store today.</p>
                                            </div>
                                            
                                        </div><!-- end card header -->
                                    </div>
                                    <!--end col-->
                                </div>
                                <!--end row-->

                                <div class="row">
                                    <div class="col-xl-3 col-md-6">
                                        <!-- card -->
                                        <div class="card card-animate">
                                            <div class="card-body">
                                                <div class="d-flex align-items-center">
                                                    <div class="flex-grow-1 overflow-hidden">
                                                        <p class="text-uppercase fw-medium text-muted text-truncate mb-0"> Total Earnings</p>
                                                    </div>
                                                    <div class="flex-shrink-0">
                                                        <h5 class="text-success fs-14 mb-0">
                                                            <i class="ri-arrow-right-up-line fs-13 align-middle"></i> +16.24 %
                                                        </h5>
                                                    </div>
                                                </div>
                                                <div class="d-flex align-items-end justify-content-between mt-4">
                                                    <div>
                                                        <h4 class="fs-22 fw-semibold ff-secondary mb-4">â‚¹<span class="counter-value" data-target="559.25"><%= totalEarningsAmount%></span> </h4>
                                                        <a href="#" class="text-decoration-underline">View net earnings</a>
                                                    </div>
                                                    <div class="avatar-sm flex-shrink-0">
                                                        <span class="avatar-title bg-success rounded fs-3">
                                                            <i class="bx bx-dollar-circle"></i>
                                                        </span>
                                                    </div>
                                                </div>
                                            </div><!-- end card body -->
                                        </div><!-- end card -->
                                    </div><!-- end col -->

                                    <div class="col-xl-3 col-md-6">
                                        <!-- card -->
                                        <div class="card card-animate">
                                            <div class="card-body">
                                                <div class="d-flex align-items-center">
                                                    <div class="flex-grow-1 overflow-hidden">
                                                        <p class="text-uppercase fw-medium text-muted text-truncate mb-0">Orders</p>
                                                    </div>
                                                    <div class="flex-shrink-0">
                                                        <h5 class="text-danger fs-14 mb-0">
                                                            <i class="ri-arrow-right-down-line fs-13 align-middle"></i> -3.57 %
                                                        </h5>
                                                    </div>
                                                </div>
                                                <div class="d-flex align-items-end justify-content-between mt-4">
                                                    <div>
                                                        <h4 class="fs-22 fw-semibold ff-secondary mb-4"><span class="counter-value" data-target="36894"><%= totalOrders%></span></h4>
                                                        <a href="#" class="text-decoration-underline">View all orders</a>
                                                    </div>
                                                    <div class="avatar-sm flex-shrink-0">
                                                        <span class="avatar-title bg-info rounded fs-3">
                                                            <i class="bx bx-shopping-bag"></i>
                                                        </span>
                                                    </div>
                                                </div>
                                            </div><!-- end card body -->
                                        </div><!-- end card -->
                                    </div><!-- end col -->

                                    <div class="col-xl-3 col-md-6">
                                        <!-- card -->
                                        <div class="card card-animate">
                                            <div class="card-body">
                                                <div class="d-flex align-items-center">
                                                    <div class="flex-grow-1 overflow-hidden">
                                                        <p class="text-uppercase fw-medium text-muted text-truncate mb-0">Customers</p>
                                                    </div>
                                                    <div class="flex-shrink-0">
                                                        <h5 class="text-success fs-14 mb-0">
                                                            <i class="ri-arrow-right-up-line fs-13 align-middle"></i> +29.08 %
                                                        </h5>
                                                    </div>
                                                </div>
                                                <div class="d-flex align-items-end justify-content-between mt-4">
                                                    <div>
                                                        <h4 class="fs-22 fw-semibold ff-secondary mb-4"><span class="counter-value" data-target="183.35"><%= totalUsers%></span> </h4>
                                                        <a href="#" class="text-decoration-underline">See details</a>
                                                    </div>
                                                    <div class="avatar-sm flex-shrink-0">
                                                        <span class="avatar-title bg-warning rounded fs-3">
                                                            <i class="bx bx-user-circle"></i>
                                                        </span>
                                                    </div>
                                                </div>
                                            </div><!-- end card body -->
                                        </div><!-- end card -->
                                    </div><!-- end col -->

                              
                                </div> <!-- end row-->
                                        
                                <div class="charts">
                                    <div class="chart">
                                      <div class="dropdown">
                                        <button class="btn btn-secondary dropdown-toggle" type="button" id="sortDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                          Sort by
                                        </button>
                                        <ul class="dropdown-menu" aria-labelledby="sortDropdown">
                                            <li><a class="dropdown-item" href="#" value="1M">1 Month</a></li>
                                            <li><a class="dropdown-item" href="#" value="6M">6 Months</a></li>
                                            <li><a class="dropdown-item" href="#" value="1Y">1 Year</a></li>
                                          </ul>
                                      </div>
                                  
                                      <div class="download-report">
                                        <div class="btn-group" id="downloadDropdown">
                                          <button type="button" class="btn btn-primary dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                                            Download Report
                                          </button>
                                          <ul class="dropdown-menu">
                                            <li><a id="pdfLink" class="dropdown-item" href="#" onclick="downloadSalesReport('pdf')">Download PDF</a></li>
                                            <li><a id="excelLink" class="dropdown-item" href="#" onclick="downloadSalesReport('excel')">Download Excel</a></li>
                                          </ul>
                                        </div>
                                      </div>
                                  
                                     
                                      <h2>Earnings (past 12 months)</h2>
                                      <div>
                                        <canvas id="lineChart"></canvas>
                                      </div>
                                    </div>
                                    <div class="chart doughnut-chart">
                                      <h2>Best Selling Products</h2>
                                      <div>
                                        <canvas id="doughnut"></canvas>
                                      </div>
                                    </div>
                                  </div>
                                  
                                  <!-- Replace 'yourDialogId' with the actual ID of your dialog element -->
                               

                                       

                                

                            </div> <!-- end .h-100-->

                        </div> <!-- end col -->

                         <!-- end col -->
                    </div>

                </div>
                <!-- container-fluid -->
            </div>
            <script src="https://cdn.jsdelivr.net/npm/chart.js@3.5.1/dist/chart.min.js"></script>
            <script src="/assets/js/chart/chart1.js"></script>
            <script src="/assets/js/chart/chart2.js"></script>
            <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
            <script>
                // Function to download the sales report based on the selected time interval, sort by, and file format
                function downloadSalesReport() {
                  const reportType = document.getElementById('sortDropdown').value;
                  const fileFormat = document.querySelector('.active-pdf') ? 'pdf' : 'excel';
                  const sortOption = document.getElementById('sortDropdown').getAttribute('data-sort-option'); // Assuming this attribute holds your sorting option value
                    console.log(sortOption);
                  const data = {
                    reportType: reportType,
                    fileFormat: fileFormat,
                    sortOption: sortOption,
                  };
              
                  $.ajax({
                    url: '/admin/salesReport',
                    method: 'POST',
                    data: data,
                    xhrFields: {
                      responseType: 'arraybuffer',
                    },
                    success: function (response) {
                      const blobType = fileFormat === 'pdf' ? 'application/pdf' : 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet';
                      const extension = fileFormat === 'pdf' ? 'pdf' : 'xlsx';
                      
                      const blob = new Blob([response], { type: blobType });
                      const url = URL.createObjectURL(blob);
              
                      const downloadLink = document.createElement('a');
                      downloadLink.href = url;
                      downloadLink.download = `sales_report.${extension}`;
              
                      downloadLink.click();
                      URL.revokeObjectURL(url);
                    },
                    error: function (error) {
                      console.error(error);
                    },
                  });
              
                  hideDialog();
                }
              
                // Function to hide the dialog
                function hideDialog() {
                  const dialog = document.getElementById('yourDialogId');
                  dialog.style.display = 'none';
                }
              
                // Attach click event listeners to the PDF and Excel links in the dropdown menu
                document.getElementById('pdfLink').addEventListener('click', function (e) {
                  e.preventDefault();
                  document.getElementById('pdfLink').classList.add('active-pdf');
                  document.getElementById('excelLink').classList.remove('active-pdf');
                });
              
                document.getElementById('excelLink').addEventListener('click', function (e) {
                  e.preventDefault();
                  document.getElementById('excelLink').classList.add('active-pdf');
                  document.getElementById('pdfLink').classList.remove('active-pdf');
                });
              
                // Attach change event listener to the sort dropdown
                document.getElementById('sortDropdown').addEventListener('change', function () {
                  const sortOption = this.value;
                  this.setAttribute('data-sort-option', sortOption);
                });
              </script>
              



<%-include("../layout/adminFooter.ejs")%>