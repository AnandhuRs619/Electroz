<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->

  <title>Electro - HTML Ecommerce Template</title>

  <!-- Google font -->
  <link href="https://fonts.googleapis.com/css?family=Montserrat:400,500,700" rel="stylesheet" />

  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet">


  <!-- Bootstrap -->
  <link type="text/css" rel="stylesheet" href="/css/bootstrap.min.css" />

  <!-- Slick -->
  <link type="text/css" rel="stylesheet" href="/css/slick.css" />
  <link type="text/css" rel="stylesheet" href="/css/slick-theme.css" />

  <!-- nouislider -->
  <link type="text/css" rel="stylesheet" href="/css/nouislider.min.css" />

  <!-- Font Awesome Icon -->
  <link rel="stylesheet" href="/css/font-awesome.min.css" />

  <!-- Custom stlylesheet -->
  <link type="text/css" rel="stylesheet" href="/css/style.css" />

  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body>
  <!-- HEADER -->
  <header>
    <!-- TOP HEADER -->
    <div id="top-header">
      <div class="container">
        <ul class="header-links pull-left">
          <!-- <li>
              <a href="#"><i class="fa fa-phone"></i> +021-95-51-84</a>
            </li>
            <li>
              <a href="#"><i class="fa fa-envelope-o"></i> email@email.com</a>
            </li>
            <li>
              <a href="#"
                ><i class="fa fa-map-marker"></i> 1734 Stonecoal Road</a
              >
            </li> -->
        </ul>
        <ul class="header-links pull-right">
          <!-- <li>
              <a href="#"><i class="fa fa-dollar"></i> USD</a>
            </li>
             -->
        </ul>
      </div>
    </div>
    <!-- /TOP HEADER -->

    <!-- MAIN HEADER -->
    <div id="header">
      <!-- container -->
      <div class="container">
        <!-- row -->
        <div class="row">
          <!-- LOGO -->
          <div class="col-md-3">
            <div class="header-logo">
              <a href="#" class="logo">
                <img src="./img/logo.png" alt="" />
              </a>
            </div>
          </div>
          <!-- /LOGO -->

          <!-- SEARCH BAR -->
          <div class="col-md-5">
            <div class="header-search">
              <form id="searchForm" action="/searchProduct" method="POST">
                <select class="input-select">
                  <option value="0">All Categories</option>
                  <option value="1">Category 01</option>
                  <option value="1">Category 02</option>
                </select>
                <input class="input"  name="searchItems" placeholder="Search here" />
                <button  class="search-btn" type="submit">Search</button>
              </form>
            </div>
          </div>
          <!-- /SEARCH BAR -->

          <!-- ACCOUNT -->
          <div class="col-md-4 clearfix">
            <div class="header-ctn">
              <!-- Wishlist -->
              <div>
                <a href="/Mywishlist">
                  <i class="fa fa-heart-o"></i>
                  <span>Your Wishlist</span>
                  <div class="qty">2</div>
                </a>
              </div>
              <!-- /Wishlist -->

              <!-- Cart -->
              <div class="dropdown">
                <a class="dropdown-toggle" data-toggle="dropdown" aria-expanded="true">
                  <i class="fa fa-shopping-cart"></i>
                  <span>Your Cart</span>
                  <div class="qty">3</div>
                </a>
                <div class="cart-dropdown">
                  <div class="cart-list">
                    <div class="product-widget">
                      <div class="product-img">
                        <img src="/img/product01.png" alt="">
                      </div>
                      <div class="product-body">
                        <h3 class="product-name"><a href="#">product name go</a></h3>
                        <h4 class="product-price"><span class="qty">1x</span>$980.00</h4>
                      </div>
                      <button class="delete"><i class="fa fa-close"></i></button>
                    </div>

                    <div class="product-widget">
                      <div class="product-img">
                        <img src="/img/product02.png" alt="">
                      </div>
                      <div class="product-body">
                        <h3 class="product-name"><a href="#">product name goes here</a></h3>
                        <h4 class="product-price"><span class="qty">3x</span>$980.00</h4>
                      </div>
                      <button class="delete"><i class="fa fa-close"></i></button>
                    </div>
                  </div>
                  <div class="cart-summary">
                    <small>3 Item(s) selected</small>
                    <h5>SUBTOTAL: $2940.00</h5>
                  </div>
                  <div class="cart-btns">
                    <a href="/cart">View Cart</a>
                    <a href="/checkout">Checkout <i class="fa fa-arrow-circle-right"></i></a>
                  </div>
                </div>
              </div>
              <!-- /Cart -->


              <!-- profile -->
              <div class="dropdown">
                <a class="dropdown-toggle" data-toggle="dropdown" aria-expanded="true">
                  <i class="fa fa-user-o"></i>
                  <span>My Account</span>
                </a>
                <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                  <li><a class="dropdown-item" href="/myprofile">My Profile</a></li>
                  <li><a class="dropdown-item" href="/Myorders">My Orders</a></li>
                  <li><a class="dropdown-item" href="/login">Login</a></li>
                  <li><a class="dropdown-item" href="/signup">Sign Up</a></li>
                  <li><a class="dropdown-item" href="/logout">Logout</a></li>
                </ul>
              </div>
              <!-- /profile -->

              <!-- Menu Toogle -->
              <div class="menu-toggle">
                <a href="#">
                  <i class="fa fa-bars"></i>
                  <span>Menu</span>
                </a>
              </div>
              <!-- /Menu Toogle -->
            </div>
          </div>
          <!-- /ACCOUNT -->
        </div>
        <!-- row -->
      </div>
      <!-- container -->
    </div>
    <!-- /MAIN HEADER -->
  </header>
  <!-- /HEADER -->

  <!-- NAVIGATION -->
  <nav id="navigation">
    <!-- container -->
    <div class="container">
      <!-- responsive-nav -->
      <div id="responsive-nav">
        <!-- NAV -->
        <ul class="main-nav nav navbar-nav">
          <li class="active"><a href="/">Home</a></li>
          <!-- <li><a href="#">Hot Deals</a></li> -->
          <li><a href="/productList">Categories</a></li>
          <li><a href="#">Laptops</a></li>
          <li><a href="#">Smartphones</a></li>
          <li><a href="#">Cameras</a></li>
          <li><a href="#">Accessories</a></li>
        </ul>
        <!-- /NAV -->
      </div>
      <!-- /responsive-nav -->
    </div>
    <!-- /container -->
  </nav>
  <!-- /NAVIGATION -->

		<!-- BREADCRUMB -->
		<div id="breadcrumb" class="section">
			<!-- container -->
			<div class="container">
				<!-- row -->
				<div class="row">
					<div class="col-md-12">
						<ul class="breadcrumb-tree">
							<li><a href="/">Home</a></li>
							<li class="active">ALl Categories (<%= totalProduct.length %> Results)</li>
							<!-- <li><a href="#">All Categories</a></li> -->
							<!-- <li><a href="#">Accessories</a></li> -->
						</ul>
					</div>
				</div>
				<!-- /row -->
			</div>
			<!-- /container -->
		</div>
		<!-- /BREADCRUMB -->

		<!-- SECTION -->
		<div class="section">
			<!-- container -->
			<div class="container">
				<!-- row -->
				<div class="row">
					<!-- ASIDE -->
					
					<div id="aside" class="col-md-3">
						<!-- aside Widget -->
						<div class="store-filter-widget">
							<h3 class="aside-title">Categories</h3>
							<div class="checkbox-filter">
							  <div class="input-checkbox">
								<input type="checkbox" id="categoryFilter" name="category" value="">
								<label for="categoryFilter">
								  <span></span>
								  All Categories
								  <small>(<%= totalProduct.length %>)</small>
								</label>
							  </div>
							  <% category.forEach((data) => { %>
							  <div class="input-checkbox">
								<input type="checkbox" id="category-<%= data._id %>" name="category" value="<%= data.categoryName %>">
								<label for="category-<%= data._id %>">
								  <span></span>
								  <%= data.categoryName %>
								  <small>(<%= productCountPerCategory[data.categoryName] || 0 %>)</small>
								</label>
							  </div>
							  <% }) %>
							</div>
						  </div>
						<!-- /aside Widget -->

						<!-- aside Widget -->
						<div class="store-filter-widget">
							<h3 class="aside-title">Price</h3>
							<div class="price-filter">
							  <div class="input-number price-min">
								<input id="minPriceFilter" type="number" placeholder="Min Price">
								<span class="qty-up">+</span>
								<span class="qty-down">-</span>
							  </div>
							  <span>-</span>
							  <div class="input-number price-max">
								<input id="maxPriceFilter" type="number" placeholder="Max Price">
								<span class="qty-up">+</span>
								<span class="qty-down">-</span>
							  </div>
							</div>
						  </div>
						<!-- /aside Widget -->

						<!-- aside Widget -->
						<div class="store-filter-widget">
							<h3 class="aside-title">Brand</h3>
							<div class="checkbox-filter">
							  <div class="input-checkbox">
								<input type="checkbox" id="brandFilter" name="brand" value="">
								<label for="brandFilter">
								  <span></span>
								  All Brands
								  <small>(<%= totalProduct.length %>)</small>
								</label>
							  </div>
							  <% brands.forEach((brand) => { %>
							  <div class="input-checkbox">
								<input type="checkbox" id="brand-<%= brand %>" name="brand" value="<%= brand %>">
								<label for="brand-<%= brand %>">
								  <span></span>
								  <%= brand %>
								  <small>(<%= productCountPerBrand[brand] || 0 %>)</small>
								</label>
							  </div>
							  <% }) %>
							</div>
						
							<!-- Apply Filter Button -->
					  
							<button class="btn btn-sm btn-primary" id="applyFilterBtn">Apply</button>

							 
						 <!-- /store top filter -->
						 <!-- /aside Widget -->
						  </div>

						<!-- aside Widget -->
						<div class="aside">
							<h3 class="aside-title">Top selling</h3>
							<div class="product-widget">
								<div class="product-img">
									<img src="./img/product01.png" alt="">
								</div>
								<div class="product-body">
									<p class="product-category">Category</p>
									<h3 class="product-name"><a href="#">product name goes here</a></h3>
									<h4 class="product-price">$980.00 <del class="product-old-price">$990.00</del></h4>
								</div>
							</div>

							<div class="product-widget">
								<div class="product-img">
									<img src="./img/product02.png" alt="">
								</div>
								<div class="product-body">
									<p class="product-category">Category</p>
									<h3 class="product-name"><a href="#">product name goes here</a></h3>
									<h4 class="product-price">$980.00 <del class="product-old-price">$990.00</del></h4>
								</div>
							</div>

							<div class="product-widget">
								<div class="product-img">
									<img src="./img/product03.png" alt="">
								</div>
								<div class="product-body">
									<p class="product-category">Category</p>
									<h3 class="product-name"><a href="#">product name goes here</a></h3>
									<h4 class="product-price">$980.00 <del class="product-old-price">$990.00</del></h4>
								</div>
							</div>
						</div>
						<!-- /aside Widget -->
						
					</div>
					<!-- /ASIDE -->

					<!-- STORE -->
					<div id="store" class="col-md-9">
						<!-- store top filter -->
						<div class="store-filter clearfix">
							<div class="store-sort">
								<label>
									Sort By:
									<select class="input-select" id="sortSelect">
										<option value="0">High to Low</option>
										<option value="1">Low to High</option>
									</select>
								</label>
							</div>
							
						</div>
						<!-- /store top filter -->

						<!-- store products -->
						<div class="row"id="searchResults">
							 <!-- <div id="searchResults"></div> -->
							<!-- product -->
							<%product.forEach((data,index)=>{%>
							<div class="col-md-4 col-xs-6">
								<div  class="product">
									<a href="/productList/productDetails/<%=data._id%>">
										<div  class="product-img" >
											<img src="/productimages/<%=data.image[0]%>" alt="<%=data.name%>">
											<div class="product-label">
												<span class="sale">-30%</span>
												<span class="new">NEW</span>
											</div>
										</div>
									</a>
									<div class="product-body">
										<p class="product-category"><%= data.categoryName %></p>
										<h3 class="product-name" style="max-width: 200px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;"><a href="#"><%=data.name%></a> </h3>
										<h4 class="product-price">₹<%=data.discountedPrice%><del class="product-old-price">₹<%=data.price%></del></h4>
										<div class="product-rating">
											<i class="fa fa-star"></i>
											<i class="fa fa-star"></i>
											<i class="fa fa-star"></i>
											<i class="fa fa-star"></i>
											<i class="fa fa-star"></i>
										</div>
										<div class="product-btns">
											<button class="add-to-wishlist"><i class="fa fa-heart-o"></i><span class="tooltipp">add to wishlist</span></button>
											<button class="add-to-compare"><i class="fa fa-exchange"></i><span class="tooltipp">add to compare</span></button>
											<button class="quick-view"><i class="fa fa-eye"></i><span class="tooltipp">quick view</span></button>
										</div>
									</div>
									<div class="add-to-cart">
										<input type="hidden" name="Id" value="<%=data._id%>" id="ProductId">
										<button class="add-to-cart-btn"><i class="fa fa-shopping-cart"></i> add to cart</button>
									</div>
								</div>
							</div>
							<%})%>
							<!-- /product -->
							
						</div>
						<!-- /store products -->

					  <!-- store bottom filter -->
					  <div class="store-filter clearfix">
						<span class="store-qty">
						  Showing <%= (page - 1) * productPerPage + 1 %>-
						  <%= Math.min(page * productPerPage, totalProduct.length) %> of <%= totalProduct.length %> products
						</span>
						<ul class="store-pagination" id="pagination">
						  <% for (let i = 1; i <= totalPages; i++) { %>
							<li <%= page === i ? 'class="active"' : '' %>><a href="/productList?page=<%= i %>"><%= i %></a></li>
						  <% } %>
						  <% if (page < totalPages) { %>
							<li><a href="/productList?page=<%= page + 1 %>"><i class="fa fa-angle-right"></i></a></li>
						  <% } %>
						</ul>
					  </div>
					  
					  <!-- /store bottom filter -->
					</div>
					<!-- /STORE -->
				</div>
				<!-- /row -->
			</div>
			<!-- /container -->
		</div>
		<!-- /SECTION -->
		<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

		<script>
			// Get the pagination links
			const paginationLinks = document.querySelectorAll('#pagination a');
		  
			// Add click event listener to each pagination link
			paginationLinks.forEach(link => {
			  link.addEventListener('click', (event) => {
				event.preventDefault();
				// Get the page number from the link's href attribute
				const pageNumber = link.getAttribute('href').split('=')[1];
				// Navigate to the selected page
				window.location.href = `/productList?page=${pageNumber}`;
			  });
			});
		</script>
			<script>
  // Function to build the filter query string
  function buildFilterQuery() {
    const selectedCategory = document.querySelector('input[name="category"]:checked').value;
    const selectedBrand = document.querySelector('input[name="brand"]:checked').value;
    const minPrice = parseFloat(document.getElementById("minPriceFilter").value);
    const maxPrice = parseFloat(document.getElementById("maxPriceFilter").value);

    let filterQuery = "";
    if (selectedCategory) {
      filterQuery += `&category=${encodeURIComponent(selectedCategory)}`;
    }
    if (selectedBrand) {
      filterQuery += `&brand=${encodeURIComponent(selectedBrand)}`;
    }
    if (!isNaN(minPrice)) {
      filterQuery += `&minPrice=${minPrice}`;
    }
    if (!isNaN(maxPrice)) {
      filterQuery += `&maxPrice=${maxPrice}`;
    }

    return filterQuery;
  }

  // Function to update the product listing on the frontend
  function updateProductsUI(products) {
    const searchResultsContainer = document.getElementById("searchResults");
    searchResultsContainer.innerHTML = "";

    products.forEach(function (data) {
      const item = `
	  <div class="col-md-4 col-xs-6">
								<div  class="product">
									<a href="/productList/productDetails/${data._id}">
										<div  class="product-img" >
											<img src="/productimages/${data.image[0]}"alt="${data.name}">
											<div class="product-label">
												<span class="sale">-30%</span>
												<span class="new">NEW</span>
											</div>
										</div>
									</a>
									<div class="product-body">
										<p class="product-category"></p>
										<h3 class="product-name"><a href="#">${data.name}</a></h3>
										<h4 class="product-price">₹${data.price}<del class="product-old-price">₹990.00</del></h4>
										<div class="product-rating">
											<i class="fa fa-star"></i>
											<i class="fa fa-star"></i>
											<i class="fa fa-star"></i>
											<i class="fa fa-star"></i>
											<i class="fa fa-star"></i>
										</div>
										<div class="product-btns">
											<button class="add-to-wishlist"><i class="fa fa-heart-o"></i><span class="tooltipp">add to wishlist</span></button>
											<button class="add-to-compare"><i class="fa fa-exchange"></i><span class="tooltipp">add to compare</span></button>
											<button class="quick-view"><i class="fa fa-eye"></i><span class="tooltipp">quick view</span></button>
										</div>
									</div>
									<div class="add-to-cart">
										<input type="hidden" name="Id" value="${data._id}" id="ProductId">
										<button class="add-to-cart-btn"><i class="fa fa-shopping-cart"></i> add to cart</button>
									</div>
								</div>
							</div>
      `;
      searchResultsContainer.innerHTML += item;
    });
  }

  // Function to fetch filtered products from the backend
  function fetchFilteredProducts() {
    const filterQuery = buildFilterQuery();
    const sortType = document.getElementById("sortSelect").value;
    const page = 1; // Assuming you want to reset to the first page after applying filters

    fetch(`/productList/filter?page=${page}&sort=${sortType}${filterQuery}`)
      .then(response => response.json())
      .then(data => {
        updateProductsUI(data);
      })
      .catch(error => {
        console.error("Error fetching filtered products:", error);
      });
  }

  // Filter products based on selected options and update the UI
  document.getElementById("applyFilterBtn").addEventListener("click", function () {
    fetchFilteredProducts();
  });

  // ... Other code for search functionality and pagination remains the same
</script>

		
		  
		<script>
		$(document).ready(function () {
  $("#searchForm").submit(function (event) {
    event.preventDefault();

    var searchQuery = $("input[name='searchItems']").val();

	console.log(searchQuery);
    $.ajax({
      url: "/searchProduct",
      method: "POST",
      data: { search: searchQuery },
      success: function (response) {
		console.log(response);
        UIupdate(response);
      },
      error: function (error) {
        console.log(error);
      },
    });
  });

  function UIupdate(response) {
    const searchResultsContainer = document.getElementById("searchResults");
    searchResultsContainer.innerHTML = "";

    response.forEach(function (data) {
      // Create the HTML for each search result item (similar to the code you provided)
	//   console.log(data);
      const item = `
	  <div class="col-md-4 col-xs-6">
								<div  class="product">
									<a href="/productList/productDetails/${data._id}">
										<div  class="product-img" >
											<img src="/productimages/${data.image[0]}"alt="${data.name}">
											<div class="product-label">
												<span class="sale">-30%</span>
												<span class="new">NEW</span>
											</div>
										</div>
									</a>
									<div class="product-body">
										<p class="product-category"></p>
										<h3 class="product-name"><a href="#">${data.name}</a></h3>
										<h4 class="product-price">₹${data.price}<del class="product-old-price">₹990.00</del></h4>
										<div class="product-rating">
											<i class="fa fa-star"></i>
											<i class="fa fa-star"></i>
											<i class="fa fa-star"></i>
											<i class="fa fa-star"></i>
											<i class="fa fa-star"></i>
										</div>
										<div class="product-btns">
											<button class="add-to-wishlist"><i class="fa fa-heart-o"></i><span class="tooltipp">add to wishlist</span></button>
											<button class="add-to-compare"><i class="fa fa-exchange"></i><span class="tooltipp">add to compare</span></button>
											<button class="quick-view"><i class="fa fa-eye"></i><span class="tooltipp">quick view</span></button>
										</div>
									</div>
									<div class="add-to-cart">
										<input type="hidden" name="Id" value="${data._id}" id="ProductId">
										<button class="add-to-cart-btn"><i class="fa fa-shopping-cart"></i> add to cart</button>
									</div>
								</div>
							</div>
      `;
      // Append the item to the search results container
      searchResultsContainer.innerHTML += item;
    });
  }
});

</script>
		<script>
			const form = document.getElementById('formSubmit');
			const productId = document.getElementById('ProductId');
			const msg = document.getElementById('msg');
			form.addEventListener('submit', (event) => {
				event.preventDefault();
				const value = {
					productId :productId.value
				};
				console.log(value);
				fetch('/cart/addingCart', {
					method: "post",
					headers: {
						'Content-Type': 'application/json',
					},
					body: JSON.stringify(value)
				})
					.then(response => response.json())
					.then((data) => {
						msg.innerHTML = data
					})
					.catch((error) => {
						console.log(error);
					})
			});
		</script>


		<%-include("../layout/footer.ejs")%>